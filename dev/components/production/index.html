<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Production · CarboKitten</title><meta name="title" content="Production · CarboKitten"/><meta property="og:title" content="Production · CarboKitten"/><meta property="twitter:title" content="Production · CarboKitten"/><meta name="description" content="Documentation for CarboKitten."/><meta property="og:description" content="Documentation for CarboKitten."/><meta property="twitter:description" content="Documentation for CarboKitten."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">CarboKitten</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li><span class="tocitem">Models</span><ul><li><a class="tocitem" href="../../bosscher-1992/">Bosscher and Schlager 1992</a></li><li><a class="tocitem" href="../../ca-with-production/">Model with CA and Production</a></li><li><a class="tocitem" href="../../model-alcap/">ALCAPS</a></li><li><a class="tocitem" href="../../models/without-ca/">Model without CA</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../first_tutorial/">Tutorial (Pluto notebook)</a></li><li><a class="tocitem" href="../../cases/tabular-sea-level/">Tabular Sea Levels</a></li></ul></li><li><a class="tocitem" href="../../architecture/">Architecture</a></li><li><span class="tocitem">Model Components</span><ul><li><a class="tocitem" href="../components/">Components</a></li><li><a class="tocitem" href="../run_model/">Model Runner</a></li><li><a class="tocitem" href="../hdf5/">HDF5 Writer</a></li><li><a class="tocitem" href="../tag/">Tags</a></li><li><a class="tocitem" href="../boxes/">Boxes</a></li><li><a class="tocitem" href="../time/">Time</a></li><li><a class="tocitem" href="../facies/">Facies</a></li><li><a class="tocitem" href="../cellular-automata/">Cellular Automata</a></li><li><a class="tocitem" href="../waterdepth/">Water Depth</a></li><li class="is-active"><a class="tocitem" href>Production</a><ul class="internal"><li><a class="tocitem" href="#CA-Production"><span>CA Production</span></a></li><li><a class="tocitem" href="#Tests"><span>Tests</span></a></li></ul></li><li><a class="tocitem" href="../sediment_buffer/">Sediment Buffers</a></li><li><a class="tocitem" href="../../active-layer-transport/">Active Layer Transport</a></li><li><a class="tocitem" href="../../onshore-transport/">Onshore Transport</a></li></ul></li><li><a class="tocitem" href="../../visualization/">Visualizations</a></li><li><span class="tocitem">CarboCAT</span><ul><li><a class="tocitem" href="../../carbocat/">Summary</a></li></ul></li><li><span class="tocitem">Denudation</span><ul><li><a class="tocitem" href="../../denudation/denudation/">Denudation</a></li><li><a class="tocitem" href="../../denudation/empirical/">Empirical Denudation</a></li><li><a class="tocitem" href="../../denudation/chemical/">Chemical Dissolution</a></li><li><a class="tocitem" href="../../denudation/physical_erosion/">Physical Erosion</a></li></ul></li><li><span class="tocitem">Input &amp; Output</span><ul><li><a class="tocitem" href="../../input-methods/">Input Methods</a></li><li><a class="tocitem" href="../../data-export/">CSV Export</a></li></ul></li><li><span class="tocitem">Algorithms</span><ul><li><a class="tocitem" href="../../unitful/">Unitful</a></li><li><a class="tocitem" href="../../boxes/">Boxes</a></li><li><a class="tocitem" href="../../stencils/">Stencils</a></li><li><a class="tocitem" href="../../utility/">Utility</a></li><li><a class="tocitem" href="../../finite-difference-transport/">Finite Difference</a></li></ul></li><li><a class="tocitem" href="../../api/">API Documentation</a></li><li><a class="tocitem" href="../../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Model Components</a></li><li class="is-active"><a href>Production</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Production</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/MindTheGap-ERC/CarboKitten.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/MindTheGap-ERC/CarboKitten.jl/blob/main/docs/transpiled/components/production.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Production"><a class="docs-heading-anchor" href="#Production">Production</a><a id="Production-1"></a><a class="docs-heading-anchor-permalink" href="#Production" title="Permalink"></a></h1><div class="component-dag" style="overflow: scroll"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.50.0 (20211204.2007)
 -->
<!-- Pages: 1 -->
<svg width="500pt" height="412pt"
 viewBox="0.00 0.00 500.00 412.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 408)">
<polygon fill="white" stroke="transparent" points="-4,4 -4,-408 496,-408 496,4 -4,4"/>
<!-- TimeIntegration -->
<g id="node1" class="node">
<title>TimeIntegration</title>
<path fill="none" stroke="black" d="M150,-404C150,-404 12,-404 12,-404 6,-404 0,-398 0,-392 0,-392 0,-337 0,-337 0,-331 6,-325 12,-325 12,-325 150,-325 150,-325 156,-325 162,-331 162,-337 162,-337 162,-392 162,-392 162,-398 156,-404 150,-404"/>
<polyline fill="none" stroke="black" points="7,-373.5 155,-373.5 "/>
<text text-anchor="start" x="15.5" y="-382.3" font-family="Times,serif" font-weight="bold" font-size="14.00">TimeIntegration</text>
<polygon fill="#cccccc" stroke="transparent" points="7,-350.5 7,-373.5 54,-373.5 54,-350.5 7,-350.5"/>
<polyline fill="none" stroke="black" points="7,-350.5 54,-350.5 54,-373.5 7,-373.5 "/>
<text text-anchor="start" x="11" y="-358.3" font-family="Times,serif" font-size="14.00">Input</text>
<polygon fill="#cccccc" stroke="transparent" points="54,-350.5 54,-373.5 108,-373.5 108,-350.5 54,-350.5"/>
<polygon fill="none" stroke="black" points="54,-350.5 54,-373.5 108,-373.5 108,-350.5 54,-350.5"/>
<text text-anchor="start" x="58" y="-358.3" font-family="Times,serif" font-size="14.00">Facies</text>
<polygon fill="#cccccc" stroke="transparent" points="108,-350.5 108,-373.5 155,-373.5 155,-350.5 108,-350.5"/>
<polyline fill="none" stroke="black" points="155,-373.5 108,-373.5 108,-350.5 155,-350.5 "/>
<text text-anchor="start" x="112" y="-358.3" font-family="Times,serif" font-size="14.00">State</text>
<polyline fill="none" stroke="black" points="54,-331.5 54,-350.5 "/>
<text text-anchor="start" x="11" y="-338.5" font-family="monospace" font-size="10.00">time</text>
<polyline fill="none" stroke="black" points="108,-331.5 108,-350.5 "/>
<text text-anchor="start" x="58" y="-338.5" font-family="monospace" font-size="10.00"> </text>
<text text-anchor="start" x="111" y="-338.5" font-family="monospace" font-size="10.00">step</text>
</g>
<!-- WaterDepth -->
<g id="node2" class="node">
<title>WaterDepth</title>
<path fill="none" stroke="black" d="M300,-289C300,-289 42,-289 42,-289 36,-289 30,-283 30,-277 30,-277 30,-184 30,-184 30,-178 36,-172 42,-172 42,-172 300,-172 300,-172 306,-172 312,-178 312,-184 312,-184 312,-277 312,-277 312,-283 306,-289 300,-289"/>
<polyline fill="none" stroke="black" points="37,-258.5 305,-258.5 "/>
<text text-anchor="start" x="123.5" y="-267.3" font-family="Times,serif" font-weight="bold" font-size="14.00">WaterDepth</text>
<polygon fill="#cccccc" stroke="transparent" points="37,-235.5 37,-258.5 154,-258.5 154,-235.5 37,-235.5"/>
<polyline fill="none" stroke="black" points="37,-235.5 154,-235.5 154,-258.5 37,-258.5 "/>
<text text-anchor="start" x="41" y="-243.3" font-family="Times,serif" font-size="14.00">Input</text>
<polygon fill="#cccccc" stroke="transparent" points="154,-235.5 154,-258.5 208,-258.5 208,-235.5 154,-235.5"/>
<polygon fill="none" stroke="black" points="154,-235.5 154,-258.5 208,-258.5 208,-235.5 154,-235.5"/>
<text text-anchor="start" x="158" y="-243.3" font-family="Times,serif" font-size="14.00">Facies</text>
<polygon fill="#cccccc" stroke="transparent" points="208,-235.5 208,-258.5 305,-258.5 305,-235.5 208,-235.5"/>
<polyline fill="none" stroke="black" points="305,-258.5 208,-258.5 208,-235.5 305,-235.5 "/>
<text text-anchor="start" x="212" y="-243.3" font-family="Times,serif" font-size="14.00">State</text>
<polyline fill="none" stroke="black" points="154,-216.5 154,-235.5 "/>
<text text-anchor="start" x="41" y="-223.5" font-family="monospace" font-size="10.00">sea_level</text>
<polyline fill="none" stroke="black" points="208,-216.5 208,-235.5 "/>
<text text-anchor="start" x="158" y="-223.5" font-family="monospace" font-size="10.00"> </text>
<text text-anchor="start" x="211" y="-223.5" font-family="monospace" font-size="10.00">sediment_height</text>
<polyline fill="none" stroke="black" points="154,-197.5 154,-216.5 "/>
<text text-anchor="start" x="41" y="-204.5" font-family="monospace" font-size="10.00">initial_topography</text>
<polyline fill="none" stroke="black" points="208,-197.5 208,-216.5 "/>
<text text-anchor="start" x="158" y="-204.5" font-family="monospace" font-size="10.00"> </text>
<text text-anchor="start" x="211" y="-204.5" font-family="monospace" font-size="10.00"> </text>
<polyline fill="none" stroke="black" points="154,-178.5 154,-197.5 "/>
<text text-anchor="start" x="41" y="-185.5" font-family="monospace" font-size="10.00">subsidence_rate</text>
<polyline fill="none" stroke="black" points="208,-178.5 208,-197.5 "/>
<text text-anchor="start" x="158" y="-185.5" font-family="monospace" font-size="10.00"> </text>
<text text-anchor="start" x="211" y="-185.5" font-family="monospace" font-size="10.00"> </text>
</g>
<!-- TimeIntegration&#45;&gt;WaterDepth -->
<g id="edge1" class="edge">
<title>TimeIntegration&#45;&gt;WaterDepth</title>
<path fill="none" stroke="black" d="M107.27,-324.97C113.07,-316.46 119.38,-307.21 125.69,-297.95"/>
<polygon fill="black" stroke="black" points="128.73,-299.7 131.48,-289.47 122.95,-295.76 128.73,-299.7"/>
</g>
<!-- Production -->
<g id="node5" class="node">
<title>Production</title>
<path fill="none" stroke="black" d="M414.5,-136C414.5,-136 167.5,-136 167.5,-136 161.5,-136 155.5,-130 155.5,-124 155.5,-124 155.5,-12 155.5,-12 155.5,-6 161.5,0 167.5,0 167.5,0 414.5,0 414.5,0 420.5,0 426.5,-6 426.5,-12 426.5,-12 426.5,-124 426.5,-124 426.5,-130 420.5,-136 414.5,-136"/>
<polyline fill="none" stroke="black" points="163,-106 420,-106 "/>
<text text-anchor="start" x="247.5" y="-114.8" font-family="Times,serif" font-weight="bold" font-size="14.00">Production</text>
<polygon fill="#cccccc" stroke="transparent" points="163,-83 163,-106 232,-106 232,-83 163,-83"/>
<polyline fill="none" stroke="black" points="163,-83 232,-83 232,-106 163,-106 "/>
<text text-anchor="start" x="167" y="-90.8" font-family="Times,serif" font-size="14.00">Input</text>
<polygon fill="#cccccc" stroke="transparent" points="232,-83 232,-106 373,-106 373,-83 232,-83"/>
<polygon fill="none" stroke="black" points="232,-83 232,-106 373,-106 373,-83 232,-83"/>
<text text-anchor="start" x="236" y="-90.8" font-family="Times,serif" font-size="14.00">Facies</text>
<polygon fill="#cccccc" stroke="transparent" points="373,-83 373,-106 420,-106 420,-83 373,-83"/>
<polyline fill="none" stroke="black" points="420,-106 373,-106 373,-83 420,-83 "/>
<text text-anchor="start" x="377" y="-90.8" font-family="Times,serif" font-size="14.00">State</text>
<polyline fill="none" stroke="black" points="232,-64 232,-83 "/>
<text text-anchor="start" x="167" y="-71" font-family="monospace" font-size="10.00">insolation</text>
<polyline fill="none" stroke="black" points="373,-64 373,-83 "/>
<text text-anchor="start" x="236" y="-71" font-family="monospace" font-size="10.00">maximum_growth_rate</text>
<text text-anchor="start" x="376" y="-71" font-family="monospace" font-size="10.00"> </text>
<polyline fill="none" stroke="black" points="232,-45 232,-64 "/>
<text text-anchor="start" x="167" y="-52" font-family="monospace" font-size="10.00"> </text>
<polyline fill="none" stroke="black" points="373,-45 373,-64 "/>
<text text-anchor="start" x="236" y="-52" font-family="monospace" font-size="10.00">extinction_coefficient</text>
<text text-anchor="start" x="376" y="-52" font-family="monospace" font-size="10.00"> </text>
<polyline fill="none" stroke="black" points="232,-26 232,-45 "/>
<text text-anchor="start" x="167" y="-33" font-family="monospace" font-size="10.00"> </text>
<polyline fill="none" stroke="black" points="373,-26 373,-45 "/>
<text text-anchor="start" x="236" y="-33" font-family="monospace" font-size="10.00">saturation_intensity</text>
<text text-anchor="start" x="376" y="-33" font-family="monospace" font-size="10.00"> </text>
<polyline fill="none" stroke="black" points="232,-7 232,-26 "/>
<text text-anchor="start" x="167" y="-14" font-family="monospace" font-size="10.00"> </text>
<polyline fill="none" stroke="black" points="373,-7 373,-26 "/>
<text text-anchor="start" x="236" y="-14" font-family="monospace" font-size="10.00">production_offset</text>
<text text-anchor="start" x="376" y="-14" font-family="monospace" font-size="10.00"> </text>
</g>
<!-- WaterDepth&#45;&gt;Production -->
<g id="edge3" class="edge">
<title>WaterDepth&#45;&gt;Production</title>
<path fill="none" stroke="black" d="M214.32,-171.56C220.97,-162.67 227.91,-153.38 234.79,-144.18"/>
<polygon fill="black" stroke="black" points="237.62,-146.24 240.8,-136.14 232.01,-142.05 237.62,-146.24"/>
</g>
<!-- Boxes -->
<g id="node3" class="node">
<title>Boxes</title>
<path fill="none" stroke="black" d="M330,-404C330,-404 192,-404 192,-404 186,-404 180,-398 180,-392 180,-392 180,-337 180,-337 180,-331 186,-325 192,-325 192,-325 330,-325 330,-325 336,-325 342,-331 342,-337 342,-337 342,-392 342,-392 342,-398 336,-404 330,-404"/>
<polyline fill="none" stroke="black" points="187,-373.5 335,-373.5 "/>
<text text-anchor="start" x="237.5" y="-382.3" font-family="Times,serif" font-weight="bold" font-size="14.00">Boxes</text>
<polygon fill="#cccccc" stroke="transparent" points="187,-350.5 187,-373.5 234,-373.5 234,-350.5 187,-350.5"/>
<polyline fill="none" stroke="black" points="187,-350.5 234,-350.5 234,-373.5 187,-373.5 "/>
<text text-anchor="start" x="191" y="-358.3" font-family="Times,serif" font-size="14.00">Input</text>
<polygon fill="#cccccc" stroke="transparent" points="234,-350.5 234,-373.5 288,-373.5 288,-350.5 234,-350.5"/>
<polygon fill="none" stroke="black" points="234,-350.5 234,-373.5 288,-373.5 288,-350.5 234,-350.5"/>
<text text-anchor="start" x="238" y="-358.3" font-family="Times,serif" font-size="14.00">Facies</text>
<polygon fill="#cccccc" stroke="transparent" points="288,-350.5 288,-373.5 335,-373.5 335,-350.5 288,-350.5"/>
<polyline fill="none" stroke="black" points="335,-373.5 288,-373.5 288,-350.5 335,-350.5 "/>
<text text-anchor="start" x="292" y="-358.3" font-family="Times,serif" font-size="14.00">State</text>
<polyline fill="none" stroke="black" points="234,-331.5 234,-350.5 "/>
<text text-anchor="start" x="191" y="-338.5" font-family="monospace" font-size="10.00">box</text>
<polyline fill="none" stroke="black" points="288,-331.5 288,-350.5 "/>
<text text-anchor="start" x="238" y="-338.5" font-family="monospace" font-size="10.00"> </text>
<text text-anchor="start" x="291" y="-338.5" font-family="monospace" font-size="10.00"> </text>
</g>
<!-- Boxes&#45;&gt;WaterDepth -->
<g id="edge2" class="edge">
<title>Boxes&#45;&gt;WaterDepth</title>
<path fill="none" stroke="black" d="M234.73,-324.97C228.93,-316.46 222.62,-307.21 216.31,-297.95"/>
<polygon fill="black" stroke="black" points="219.05,-295.76 210.52,-289.47 213.27,-299.7 219.05,-295.76"/>
</g>
<!-- FaciesBase -->
<g id="node4" class="node">
<title>FaciesBase</title>
<path fill="none" stroke="black" d="M480,-270C480,-270 342,-270 342,-270 336,-270 330,-264 330,-258 330,-258 330,-203 330,-203 330,-197 336,-191 342,-191 342,-191 480,-191 480,-191 486,-191 492,-197 492,-203 492,-203 492,-258 492,-258 492,-264 486,-270 480,-270"/>
<polyline fill="none" stroke="black" points="337,-239.5 485,-239.5 "/>
<text text-anchor="start" x="367" y="-248.3" font-family="Times,serif" font-weight="bold" font-size="14.00">FaciesBase</text>
<polygon fill="#cccccc" stroke="transparent" points="337,-216.5 337,-239.5 384,-239.5 384,-216.5 337,-216.5"/>
<polyline fill="none" stroke="black" points="337,-216.5 384,-216.5 384,-239.5 337,-239.5 "/>
<text text-anchor="start" x="341" y="-224.3" font-family="Times,serif" font-size="14.00">Input</text>
<polygon fill="#cccccc" stroke="transparent" points="384,-216.5 384,-239.5 438,-239.5 438,-216.5 384,-216.5"/>
<polygon fill="none" stroke="black" points="384,-216.5 384,-239.5 438,-239.5 438,-216.5 384,-216.5"/>
<text text-anchor="start" x="388" y="-224.3" font-family="Times,serif" font-size="14.00">Facies</text>
<polygon fill="#cccccc" stroke="transparent" points="438,-216.5 438,-239.5 485,-239.5 485,-216.5 438,-216.5"/>
<polyline fill="none" stroke="black" points="485,-239.5 438,-239.5 438,-216.5 485,-216.5 "/>
<text text-anchor="start" x="442" y="-224.3" font-family="Times,serif" font-size="14.00">State</text>
<polyline fill="none" stroke="black" points="384,-197.5 384,-216.5 "/>
<text text-anchor="start" x="341" y="-204.5" font-family="monospace" font-size="10.00">facies</text>
<polyline fill="none" stroke="black" points="438,-197.5 438,-216.5 "/>
<text text-anchor="start" x="388" y="-204.5" font-family="monospace" font-size="10.00"> </text>
<text text-anchor="start" x="441" y="-204.5" font-family="monospace" font-size="10.00"> </text>
</g>
<!-- FaciesBase&#45;&gt;Production -->
<g id="edge4" class="edge">
<title>FaciesBase&#45;&gt;Production</title>
<path fill="none" stroke="black" d="M381.95,-190.65C371.56,-176.74 359.45,-160.56 347.53,-144.61"/>
<polygon fill="black" stroke="black" points="350.12,-142.22 341.33,-136.31 344.51,-146.42 350.12,-142.22"/>
</g>
</g>
</svg>
</div><p>The <code>Production</code> module specifies the production rate following the model by Bosscher &amp; Schlager 1992 [<a href="../../references/#Bosscher1992">1</a>]. The growth rate is given as</p><p class="math-container">\[g(w) = g_m \tanh\left({{I_0 e^{-kw}} \over {I_k}}\right).\]</p><p>This can be understood as a smooth transition between the maximum growth rate under saturated conditions, and exponential decay due to light intensity dropping with greater water depth.</p><div class="noweb-label">⪡component-production-rate⪢≣</div><pre><code class="language- julia hljs">function production_rate(insolation, facies, water_depth)
    gₘ = facies.maximum_growth_rate
    offset = facies.production_offset
    I = insolation / facies.saturation_intensity
    x = (water_depth - offset) * facies.extinction_coefficient
    return x &gt; 0.0 ? gₘ * tanh(I * exp(-x)) : 0.0u&quot;m/Myr&quot;
end</code></pre><p>From just this equation we can define a uniform production process. This requires that we have a <code>Facies</code> that defines the <code>maximum_growth_rate</code>, <code>extinction_coefficient</code> and <code>saturation_intensity</code>.</p><p>The <code>insolation</code> input may be given as a scalar quantity, say <code>400u&quot;W/m^2&quot;</code>, or as a function of time.</p><p>The <code>production_offset</code> is the uppermost length of the water column in which no production occurs. If <code>production_offset</code> is &gt; 0, the maximum production is shifted downwards in the water column by <code>production_offset</code>.</p><div class="noweb-label">file:<i>src/Components/Production.jl</i></div><pre><code class="language- julia hljs">@compose module Production
@mixin TimeIntegration, WaterDepth, FaciesBase
using ..Common
using ..WaterDepth: water_depth
using ..TimeIntegration: time, write_times
using HDF5
using Logging

export production_rate, uniform_production

@kwdef struct Facies &lt;: AbstractFacies
    maximum_growth_rate::Rate
    extinction_coefficient::typeof(1.0u&quot;m^-1&quot;)
    saturation_intensity::Intensity
    production_offset::Height = 0.0u&quot;m&quot;
end

@kwdef struct Input &lt;: AbstractInput
    insolation
end

function insolation(input::AbstractInput)
    insolation = input.insolation
    tprop = input.time
    if insolation isa Quantity
        return s -&gt; insolation
    end
    if insolation isa AbstractVector
        @info &quot;Reading insolation from a table&quot;
        return s -&gt; insolation[s.step+1]
    end
    @info &quot;Reading insolation from a function&quot;
    function (s::AbstractState)
        t = time(tprop, s)
        return insolation(t)
    end
end

function write_header(fid, input::AbstractInput)
    if input.insolation isa Quantity
        fid[&quot;input&quot;][&quot;insolation&quot;] = fill(input.insolation |&gt; in_units_of(u&quot;W/m^2&quot;), input.time.steps)
    elseif input.insolation isa AbstractVector
        fid[&quot;input&quot;][&quot;insolation&quot;] = input.insolation |&gt; in_units_of(u&quot;W/m^2&quot;)
    else
        t = write_times(input)[1:end-1]
        fid[&quot;input&quot;][&quot;insolation&quot;] = input.insolation.(t) |&gt; in_units_of(u&quot;W/m^2&quot;)
    end

    # fid[&quot;input&quot;][&quot;insolation&quot;] = insolation(input) |&gt; in_units_of(u&quot;W/m^2&quot;)
    for (i, f) in enumerate(input.facies)
        attr = attributes(fid[&quot;input/facies$(i)&quot;])
        attr[&quot;maximum_growth_rate&quot;] = f.maximum_growth_rate |&gt; in_units_of(u&quot;m/Myr&quot;)
        attr[&quot;extinction_coefficient&quot;] = f.extinction_coefficient |&gt; in_units_of(u&quot;m^-1&quot;)
        attr[&quot;saturation_intensity&quot;] = f.saturation_intensity |&gt; in_units_of(u&quot;W/m^2&quot;)
    end
end

&lt;&lt;component-production-rate&gt;&gt;

function uniform_production(input::AbstractInput)
    w = water_depth(input)
    na = [CartesianIndex()]
    insolation_func = insolation(input)
    facies = input.facies

    return function (state::AbstractState)
        return production_rate.(
            insolation_func(state),
            facies[:, na, na],
            w(state)[na, :, :])
    end
end
end</code></pre><h2 id="CA-Production"><a class="docs-heading-anchor" href="#CA-Production">CA Production</a><a id="CA-Production-1"></a><a class="docs-heading-anchor-permalink" href="#CA-Production" title="Permalink"></a></h2><div class="component-dag" style="overflow: scroll"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.50.0 (20211204.2007)
 -->
<!-- Pages: 1 -->
<svg width="614pt" height="484pt"
 viewBox="0.00 0.00 613.50 484.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 480)">
<polygon fill="white" stroke="transparent" points="-4,4 -4,-480 609.5,-480 609.5,4 -4,4"/>
<!-- TimeIntegration -->
<g id="node1" class="node">
<title>TimeIntegration</title>
<path fill="none" stroke="black" d="M210,-476C210,-476 72,-476 72,-476 66,-476 60,-470 60,-464 60,-464 60,-409 60,-409 60,-403 66,-397 72,-397 72,-397 210,-397 210,-397 216,-397 222,-403 222,-409 222,-409 222,-464 222,-464 222,-470 216,-476 210,-476"/>
<polyline fill="none" stroke="black" points="67,-445.5 215,-445.5 "/>
<text text-anchor="start" x="75.5" y="-454.3" font-family="Times,serif" font-weight="bold" font-size="14.00">TimeIntegration</text>
<polygon fill="#cccccc" stroke="transparent" points="67,-422.5 67,-445.5 114,-445.5 114,-422.5 67,-422.5"/>
<polyline fill="none" stroke="black" points="67,-422.5 114,-422.5 114,-445.5 67,-445.5 "/>
<text text-anchor="start" x="71" y="-430.3" font-family="Times,serif" font-size="14.00">Input</text>
<polygon fill="#cccccc" stroke="transparent" points="114,-422.5 114,-445.5 168,-445.5 168,-422.5 114,-422.5"/>
<polygon fill="none" stroke="black" points="114,-422.5 114,-445.5 168,-445.5 168,-422.5 114,-422.5"/>
<text text-anchor="start" x="118" y="-430.3" font-family="Times,serif" font-size="14.00">Facies</text>
<polygon fill="#cccccc" stroke="transparent" points="168,-422.5 168,-445.5 215,-445.5 215,-422.5 168,-422.5"/>
<polyline fill="none" stroke="black" points="215,-445.5 168,-445.5 168,-422.5 215,-422.5 "/>
<text text-anchor="start" x="172" y="-430.3" font-family="Times,serif" font-size="14.00">State</text>
<polyline fill="none" stroke="black" points="114,-403.5 114,-422.5 "/>
<text text-anchor="start" x="71" y="-410.5" font-family="monospace" font-size="10.00">time</text>
<polyline fill="none" stroke="black" points="168,-403.5 168,-422.5 "/>
<text text-anchor="start" x="118" y="-410.5" font-family="monospace" font-size="10.00"> </text>
<text text-anchor="start" x="171" y="-410.5" font-family="monospace" font-size="10.00">step</text>
</g>
<!-- WaterDepth -->
<g id="node3" class="node">
<title>WaterDepth</title>
<path fill="none" stroke="black" d="M270,-361C270,-361 12,-361 12,-361 6,-361 0,-355 0,-349 0,-349 0,-256 0,-256 0,-250 6,-244 12,-244 12,-244 270,-244 270,-244 276,-244 282,-250 282,-256 282,-256 282,-349 282,-349 282,-355 276,-361 270,-361"/>
<polyline fill="none" stroke="black" points="7,-330.5 275,-330.5 "/>
<text text-anchor="start" x="93.5" y="-339.3" font-family="Times,serif" font-weight="bold" font-size="14.00">WaterDepth</text>
<polygon fill="#cccccc" stroke="transparent" points="7,-307.5 7,-330.5 124,-330.5 124,-307.5 7,-307.5"/>
<polyline fill="none" stroke="black" points="7,-307.5 124,-307.5 124,-330.5 7,-330.5 "/>
<text text-anchor="start" x="11" y="-315.3" font-family="Times,serif" font-size="14.00">Input</text>
<polygon fill="#cccccc" stroke="transparent" points="124,-307.5 124,-330.5 178,-330.5 178,-307.5 124,-307.5"/>
<polygon fill="none" stroke="black" points="124,-307.5 124,-330.5 178,-330.5 178,-307.5 124,-307.5"/>
<text text-anchor="start" x="128" y="-315.3" font-family="Times,serif" font-size="14.00">Facies</text>
<polygon fill="#cccccc" stroke="transparent" points="178,-307.5 178,-330.5 275,-330.5 275,-307.5 178,-307.5"/>
<polyline fill="none" stroke="black" points="275,-330.5 178,-330.5 178,-307.5 275,-307.5 "/>
<text text-anchor="start" x="182" y="-315.3" font-family="Times,serif" font-size="14.00">State</text>
<polyline fill="none" stroke="black" points="124,-288.5 124,-307.5 "/>
<text text-anchor="start" x="11" y="-295.5" font-family="monospace" font-size="10.00">sea_level</text>
<polyline fill="none" stroke="black" points="178,-288.5 178,-307.5 "/>
<text text-anchor="start" x="128" y="-295.5" font-family="monospace" font-size="10.00"> </text>
<text text-anchor="start" x="181" y="-295.5" font-family="monospace" font-size="10.00">sediment_height</text>
<polyline fill="none" stroke="black" points="124,-269.5 124,-288.5 "/>
<text text-anchor="start" x="11" y="-276.5" font-family="monospace" font-size="10.00">initial_topography</text>
<polyline fill="none" stroke="black" points="178,-269.5 178,-288.5 "/>
<text text-anchor="start" x="128" y="-276.5" font-family="monospace" font-size="10.00"> </text>
<text text-anchor="start" x="181" y="-276.5" font-family="monospace" font-size="10.00"> </text>
<polyline fill="none" stroke="black" points="124,-250.5 124,-269.5 "/>
<text text-anchor="start" x="11" y="-257.5" font-family="monospace" font-size="10.00">subsidence_rate</text>
<polyline fill="none" stroke="black" points="178,-250.5 178,-269.5 "/>
<text text-anchor="start" x="128" y="-257.5" font-family="monospace" font-size="10.00"> </text>
<text text-anchor="start" x="181" y="-257.5" font-family="monospace" font-size="10.00"> </text>
</g>
<!-- TimeIntegration&#45;&gt;WaterDepth -->
<g id="edge1" class="edge">
<title>TimeIntegration&#45;&gt;WaterDepth</title>
<path fill="none" stroke="black" d="M141,-396.97C141,-388.98 141,-380.34 141,-371.65"/>
<polygon fill="black" stroke="black" points="144.5,-371.47 141,-361.47 137.5,-371.47 144.5,-371.47"/>
</g>
<!-- Boxes -->
<g id="node2" class="node">
<title>Boxes</title>
<path fill="none" stroke="black" d="M474,-476C474,-476 336,-476 336,-476 330,-476 324,-470 324,-464 324,-464 324,-409 324,-409 324,-403 330,-397 336,-397 336,-397 474,-397 474,-397 480,-397 486,-403 486,-409 486,-409 486,-464 486,-464 486,-470 480,-476 474,-476"/>
<polyline fill="none" stroke="black" points="331,-445.5 479,-445.5 "/>
<text text-anchor="start" x="381.5" y="-454.3" font-family="Times,serif" font-weight="bold" font-size="14.00">Boxes</text>
<polygon fill="#cccccc" stroke="transparent" points="331,-422.5 331,-445.5 378,-445.5 378,-422.5 331,-422.5"/>
<polyline fill="none" stroke="black" points="331,-422.5 378,-422.5 378,-445.5 331,-445.5 "/>
<text text-anchor="start" x="335" y="-430.3" font-family="Times,serif" font-size="14.00">Input</text>
<polygon fill="#cccccc" stroke="transparent" points="378,-422.5 378,-445.5 432,-445.5 432,-422.5 378,-422.5"/>
<polygon fill="none" stroke="black" points="378,-422.5 378,-445.5 432,-445.5 432,-422.5 378,-422.5"/>
<text text-anchor="start" x="382" y="-430.3" font-family="Times,serif" font-size="14.00">Facies</text>
<polygon fill="#cccccc" stroke="transparent" points="432,-422.5 432,-445.5 479,-445.5 479,-422.5 432,-422.5"/>
<polyline fill="none" stroke="black" points="479,-445.5 432,-445.5 432,-422.5 479,-422.5 "/>
<text text-anchor="start" x="436" y="-430.3" font-family="Times,serif" font-size="14.00">State</text>
<polyline fill="none" stroke="black" points="378,-403.5 378,-422.5 "/>
<text text-anchor="start" x="335" y="-410.5" font-family="monospace" font-size="10.00">box</text>
<polyline fill="none" stroke="black" points="432,-403.5 432,-422.5 "/>
<text text-anchor="start" x="382" y="-410.5" font-family="monospace" font-size="10.00"> </text>
<text text-anchor="start" x="435" y="-410.5" font-family="monospace" font-size="10.00"> </text>
</g>
<!-- Boxes&#45;&gt;WaterDepth -->
<g id="edge2" class="edge">
<title>Boxes&#45;&gt;WaterDepth</title>
<path fill="none" stroke="black" d="M327.93,-396.97C308.35,-387.18 286.82,-376.41 265.54,-365.77"/>
<polygon fill="black" stroke="black" points="266.95,-362.56 256.44,-361.22 263.82,-368.82 266.95,-362.56"/>
</g>
<!-- CellularAutomaton -->
<g id="node7" class="node">
<title>CellularAutomaton</title>
<path fill="none" stroke="black" d="M593.5,-189C593.5,-189 332.5,-189 332.5,-189 326.5,-189 320.5,-183 320.5,-177 320.5,-177 320.5,-103 320.5,-103 320.5,-97 326.5,-91 332.5,-91 332.5,-91 593.5,-91 593.5,-91 599.5,-91 605.5,-97 605.5,-103 605.5,-103 605.5,-177 605.5,-177 605.5,-183 599.5,-189 593.5,-189"/>
<polyline fill="none" stroke="black" points="328,-159 599,-159 "/>
<text text-anchor="start" x="388" y="-167.8" font-family="Times,serif" font-weight="bold" font-size="14.00">CellularAutomaton</text>
<polygon fill="#cccccc" stroke="transparent" points="328,-136 328,-159 421,-159 421,-136 328,-136"/>
<polyline fill="none" stroke="black" points="328,-136 421,-136 421,-159 328,-159 "/>
<text text-anchor="start" x="332" y="-143.8" font-family="Times,serif" font-size="14.00">Input</text>
<polygon fill="#cccccc" stroke="transparent" points="421,-136 421,-159 526,-159 526,-136 421,-136"/>
<polygon fill="none" stroke="black" points="421,-136 421,-159 526,-159 526,-136 421,-136"/>
<text text-anchor="start" x="425" y="-143.8" font-family="Times,serif" font-size="14.00">Facies</text>
<polygon fill="#cccccc" stroke="transparent" points="526,-136 526,-159 599,-159 599,-136 526,-136"/>
<polyline fill="none" stroke="black" points="599,-159 526,-159 526,-136 599,-136 "/>
<text text-anchor="start" x="530" y="-143.8" font-family="Times,serif" font-size="14.00">State</text>
<polyline fill="none" stroke="black" points="421,-117 421,-136 "/>
<text text-anchor="start" x="332" y="-124" font-family="monospace" font-size="10.00">ca_interval</text>
<polyline fill="none" stroke="black" points="526,-117 526,-136 "/>
<text text-anchor="start" x="425" y="-124" font-family="monospace" font-size="10.00">viability_range</text>
<text text-anchor="start" x="529" y="-124" font-family="monospace" font-size="10.00">ca</text>
<polyline fill="none" stroke="black" points="421,-98 421,-117 "/>
<text text-anchor="start" x="332" y="-105" font-family="monospace" font-size="10.00">ca_random_seed</text>
<polyline fill="none" stroke="black" points="526,-98 526,-117 "/>
<text text-anchor="start" x="425" y="-105" font-family="monospace" font-size="10.00">activation_range</text>
<text text-anchor="start" x="529" y="-105" font-family="monospace" font-size="10.00">ca_priority</text>
</g>
<!-- Boxes&#45;&gt;CellularAutomaton -->
<g id="edge7" class="edge">
<title>Boxes&#45;&gt;CellularAutomaton</title>
<path fill="none" stroke="black" d="M448.74,-396.61C457.81,-386.05 466.1,-373.93 471,-361 490.78,-308.84 485.41,-244.64 477.13,-199.09"/>
<polygon fill="black" stroke="black" points="480.53,-198.25 475.21,-189.08 473.66,-199.57 480.53,-198.25"/>
</g>
<!-- Production -->
<g id="node5" class="node">
<title>Production</title>
<path fill="none" stroke="black" d="M290.5,-208C290.5,-208 43.5,-208 43.5,-208 37.5,-208 31.5,-202 31.5,-196 31.5,-196 31.5,-84 31.5,-84 31.5,-78 37.5,-72 43.5,-72 43.5,-72 290.5,-72 290.5,-72 296.5,-72 302.5,-78 302.5,-84 302.5,-84 302.5,-196 302.5,-196 302.5,-202 296.5,-208 290.5,-208"/>
<polyline fill="none" stroke="black" points="39,-178 296,-178 "/>
<text text-anchor="start" x="123.5" y="-186.8" font-family="Times,serif" font-weight="bold" font-size="14.00">Production</text>
<polygon fill="#cccccc" stroke="transparent" points="39,-155 39,-178 108,-178 108,-155 39,-155"/>
<polyline fill="none" stroke="black" points="39,-155 108,-155 108,-178 39,-178 "/>
<text text-anchor="start" x="43" y="-162.8" font-family="Times,serif" font-size="14.00">Input</text>
<polygon fill="#cccccc" stroke="transparent" points="108,-155 108,-178 249,-178 249,-155 108,-155"/>
<polygon fill="none" stroke="black" points="108,-155 108,-178 249,-178 249,-155 108,-155"/>
<text text-anchor="start" x="112" y="-162.8" font-family="Times,serif" font-size="14.00">Facies</text>
<polygon fill="#cccccc" stroke="transparent" points="249,-155 249,-178 296,-178 296,-155 249,-155"/>
<polyline fill="none" stroke="black" points="296,-178 249,-178 249,-155 296,-155 "/>
<text text-anchor="start" x="253" y="-162.8" font-family="Times,serif" font-size="14.00">State</text>
<polyline fill="none" stroke="black" points="108,-136 108,-155 "/>
<text text-anchor="start" x="43" y="-143" font-family="monospace" font-size="10.00">insolation</text>
<polyline fill="none" stroke="black" points="249,-136 249,-155 "/>
<text text-anchor="start" x="112" y="-143" font-family="monospace" font-size="10.00">maximum_growth_rate</text>
<text text-anchor="start" x="252" y="-143" font-family="monospace" font-size="10.00"> </text>
<polyline fill="none" stroke="black" points="108,-117 108,-136 "/>
<text text-anchor="start" x="43" y="-124" font-family="monospace" font-size="10.00"> </text>
<polyline fill="none" stroke="black" points="249,-117 249,-136 "/>
<text text-anchor="start" x="112" y="-124" font-family="monospace" font-size="10.00">extinction_coefficient</text>
<text text-anchor="start" x="252" y="-124" font-family="monospace" font-size="10.00"> </text>
<polyline fill="none" stroke="black" points="108,-98 108,-117 "/>
<text text-anchor="start" x="43" y="-105" font-family="monospace" font-size="10.00"> </text>
<polyline fill="none" stroke="black" points="249,-98 249,-117 "/>
<text text-anchor="start" x="112" y="-105" font-family="monospace" font-size="10.00">saturation_intensity</text>
<text text-anchor="start" x="252" y="-105" font-family="monospace" font-size="10.00"> </text>
<polyline fill="none" stroke="black" points="108,-79 108,-98 "/>
<text text-anchor="start" x="43" y="-86" font-family="monospace" font-size="10.00"> </text>
<polyline fill="none" stroke="black" points="249,-79 249,-98 "/>
<text text-anchor="start" x="112" y="-86" font-family="monospace" font-size="10.00">production_offset</text>
<text text-anchor="start" x="252" y="-86" font-family="monospace" font-size="10.00"> </text>
</g>
<!-- WaterDepth&#45;&gt;Production -->
<g id="edge3" class="edge">
<title>WaterDepth&#45;&gt;Production</title>
<path fill="none" stroke="black" d="M150.39,-243.56C151.72,-235.29 153.12,-226.69 154.5,-218.14"/>
<polygon fill="black" stroke="black" points="157.98,-218.57 156.12,-208.14 151.07,-217.45 157.98,-218.57"/>
</g>
<!-- FaciesBase -->
<g id="node4" class="node">
<title>FaciesBase</title>
<path fill="none" stroke="black" d="M450,-342C450,-342 312,-342 312,-342 306,-342 300,-336 300,-330 300,-330 300,-275 300,-275 300,-269 306,-263 312,-263 312,-263 450,-263 450,-263 456,-263 462,-269 462,-275 462,-275 462,-330 462,-330 462,-336 456,-342 450,-342"/>
<polyline fill="none" stroke="black" points="307,-311.5 455,-311.5 "/>
<text text-anchor="start" x="337" y="-320.3" font-family="Times,serif" font-weight="bold" font-size="14.00">FaciesBase</text>
<polygon fill="#cccccc" stroke="transparent" points="307,-288.5 307,-311.5 354,-311.5 354,-288.5 307,-288.5"/>
<polyline fill="none" stroke="black" points="307,-288.5 354,-288.5 354,-311.5 307,-311.5 "/>
<text text-anchor="start" x="311" y="-296.3" font-family="Times,serif" font-size="14.00">Input</text>
<polygon fill="#cccccc" stroke="transparent" points="354,-288.5 354,-311.5 408,-311.5 408,-288.5 354,-288.5"/>
<polygon fill="none" stroke="black" points="354,-288.5 354,-311.5 408,-311.5 408,-288.5 354,-288.5"/>
<text text-anchor="start" x="358" y="-296.3" font-family="Times,serif" font-size="14.00">Facies</text>
<polygon fill="#cccccc" stroke="transparent" points="408,-288.5 408,-311.5 455,-311.5 455,-288.5 408,-288.5"/>
<polyline fill="none" stroke="black" points="455,-311.5 408,-311.5 408,-288.5 455,-288.5 "/>
<text text-anchor="start" x="412" y="-296.3" font-family="Times,serif" font-size="14.00">State</text>
<polyline fill="none" stroke="black" points="354,-269.5 354,-288.5 "/>
<text text-anchor="start" x="311" y="-276.5" font-family="monospace" font-size="10.00">facies</text>
<polyline fill="none" stroke="black" points="408,-269.5 408,-288.5 "/>
<text text-anchor="start" x="358" y="-276.5" font-family="monospace" font-size="10.00"> </text>
<text text-anchor="start" x="411" y="-276.5" font-family="monospace" font-size="10.00"> </text>
</g>
<!-- FaciesBase&#45;&gt;Production -->
<g id="edge4" class="edge">
<title>FaciesBase&#45;&gt;Production</title>
<path fill="none" stroke="black" d="M329.47,-262.85C309.97,-248.23 287.08,-231.06 264.73,-214.3"/>
<polygon fill="black" stroke="black" points="266.63,-211.35 256.53,-208.15 262.43,-216.95 266.63,-211.35"/>
</g>
<!-- FaciesBase&#45;&gt;CellularAutomaton -->
<g id="edge8" class="edge">
<title>FaciesBase&#45;&gt;CellularAutomaton</title>
<path fill="none" stroke="black" d="M400.85,-262.65C410.72,-243.33 422.84,-219.6 433.75,-198.24"/>
<polygon fill="black" stroke="black" points="436.91,-199.75 438.35,-189.26 430.68,-196.57 436.91,-199.75"/>
</g>
<!-- CAProduction -->
<g id="node6" class="node">
<title>CAProduction</title>
<path fill="none" stroke="black" d="M364.5,-36C364.5,-36 265.5,-36 265.5,-36 259.5,-36 253.5,-30 253.5,-24 253.5,-24 253.5,-12 253.5,-12 253.5,-6 259.5,0 265.5,0 265.5,0 364.5,0 364.5,0 370.5,0 376.5,-6 376.5,-12 376.5,-12 376.5,-24 376.5,-24 376.5,-30 370.5,-36 364.5,-36"/>
<text text-anchor="start" x="260.5" y="-15.3" font-family="Times,serif" font-weight="bold" font-size="14.00">CAProduction</text>
</g>
<!-- Production&#45;&gt;CAProduction -->
<g id="edge6" class="edge">
<title>Production&#45;&gt;CAProduction</title>
<path fill="none" stroke="black" d="M249.65,-71.98C262.61,-61.48 275.21,-51.26 285.83,-42.65"/>
<polygon fill="black" stroke="black" points="288.33,-45.13 293.89,-36.11 283.92,-39.69 288.33,-45.13"/>
</g>
<!-- CellularAutomaton&#45;&gt;CAProduction -->
<g id="edge5" class="edge">
<title>CellularAutomaton&#45;&gt;CAProduction</title>
<path fill="none" stroke="black" d="M403.66,-90.88C383.2,-74.3 361.19,-56.45 344.21,-42.69"/>
<polygon fill="black" stroke="black" points="346.29,-39.86 336.31,-36.28 341.88,-45.3 346.29,-39.86"/>
</g>
</g>
</svg>
</div><p>The <code>CAProduction</code> component gives production that depends on the provided CA.</p><div class="noweb-label">file:<i>src/Components/CAProduction.jl</i></div><pre><code class="language- julia hljs">@compose module CAProduction
    @mixin TimeIntegration, CellularAutomaton, Production
    using ..Common
    using ..Production: production_rate, insolation
    using ..WaterDepth: water_depth
    using Logging

    function production(input::AbstractInput)
        w = water_depth(input)
        na = [CartesianIndex()]
        output = Array{Amount, 3}(undef, n_facies(input), input.box.grid_size...)

        w = water_depth(input)
        s = insolation(input)
        n_f = n_facies(input)
        facies = input.facies
        Δt = input.time.Δt

        return function(state::AbstractState)
            insolation = s(state)
            for f = 1:n_f
                output[f, :, :] = ifelse.(
                    state.ca .== f,
                    production_rate.(insolation, (facies[f],), w(state)) .* Δt,
                    0.0u&quot;m&quot;)
            end
            return output
        end
    end
end</code></pre><h2 id="Tests"><a class="docs-heading-anchor" href="#Tests">Tests</a><a id="Tests-1"></a><a class="docs-heading-anchor-permalink" href="#Tests" title="Permalink"></a></h2><h3 id="If-production-is-higher-in-shallower-water"><a class="docs-heading-anchor" href="#If-production-is-higher-in-shallower-water">If production is higher in shallower water</a><a id="If-production-is-higher-in-shallower-water-1"></a><a class="docs-heading-anchor-permalink" href="#If-production-is-higher-in-shallower-water" title="Permalink"></a></h3><div class="noweb-label">⪡production-spec⪢≣</div><pre><code class="language- julia hljs">@testset &quot;Components/Production&quot; begin
    let facies = Facies(
            maximum_growth_rate = 500u&quot;m/Myr&quot;,
            extinction_coefficient = 0.8u&quot;m^-1&quot;,
            saturation_intensity = 60u&quot;W/m^2&quot;),
        input = Input(
            box = Box{Periodic{2}}(grid_size=(10, 1), phys_scale=1.0u&quot;m&quot;),
            time = TimeProperties(Δt=1.0u&quot;kyr&quot;, steps=10),
            sea_level = t -&gt; 0.0u&quot;m&quot;,
            initial_topography = (x, y) -&gt; -10u&quot;m&quot;,
            subsidence_rate = 0.0u&quot;m/Myr&quot;,
            facies = [facies],
            insolation = 400.0u&quot;W/m^2&quot;)

        state = initial_state(input)
        prod = uniform_production(input)(state)
        @test all(prod[1:end-1,:] .&gt;= prod[2:end,:])
    end
end</code></pre><h3 id="Variable-insolation"><a class="docs-heading-anchor" href="#Variable-insolation">Variable insolation</a><a id="Variable-insolation-1"></a><a class="docs-heading-anchor-permalink" href="#Variable-insolation" title="Permalink"></a></h3><p>If insolation increases linearly with time, production at t = 10 should be higher than at t = 1.</p><div class="noweb-label">⪡production-spec⪢≣</div><pre><code class="language- julia hljs">@testset &quot;Components/Production/variable_insolation&quot; begin
    let facies = Facies(
            maximum_growth_rate = 500u&quot;m/Myr&quot;,
            extinction_coefficient = 0.8u&quot;m^-1&quot;,
            saturation_intensity = 60u&quot;W/m^2&quot;),
        input = Input(
            box = Box{Periodic{2}}(grid_size=(10, 1), phys_scale=1.0u&quot;m&quot;),
            time = TimeProperties(Δt=1.0u&quot;kyr&quot;, steps=10),
            sea_level = t -&gt; 0.0u&quot;m&quot;,
            initial_topography = (x, y) -&gt; -10u&quot;m&quot;,
            subsidence_rate = 0.0u&quot;m/Myr&quot;,
            facies = [facies],
            insolation = t -&gt; 40.0u&quot;W/m^2/kyr&quot; * t)

        state = initial_state(input)
        state.step = 1
        prod1 = copy(uniform_production(input)(state))
        state.step = 10
        prod2 = copy(uniform_production(input)(state))
        @test all(prod2 .&gt; prod1)
    end
end</code></pre><h3 id="Production-offset"><a class="docs-heading-anchor" href="#Production-offset">Production offset</a><a id="Production-offset-1"></a><a class="docs-heading-anchor-permalink" href="#Production-offset" title="Permalink"></a></h3><p>Check if there is no production above the offset depth.</p><div class="noweb-label">⪡production-spec⪢≣</div><pre><code class="language- julia hljs">@testset &quot;Components/Production/offset&quot; begin
    let facies = Facies(
            maximum_growth_rate = 500u&quot;m/Myr&quot;,
            extinction_coefficient = 0.8u&quot;m^-1&quot;,
            saturation_intensity = 60u&quot;W/m^2&quot;,
            production_offset = 5.0u&quot;m&quot;),
        input = Input(
            box = Box{Periodic{2}}(grid_size=(10, 1), phys_scale=1.0u&quot;m&quot;),
            time = TimeProperties(Δt=1.0u&quot;kyr&quot;, steps=10),
            sea_level = t -&gt; 0.0u&quot;m&quot;,
            initial_topography = (x, y) -&gt; -x,
            subsidence_rate = 0.0u&quot;m/Myr&quot;,
            facies = [facies],
            insolation = 400.0u&quot;W/m^2&quot;)

        state = initial_state(input)
        prod = uniform_production(input)(state)
        @test all(prod[1,1:5,1] .== 0.0u&quot;m/Myr&quot;)
        @test all(prod[1,7:10,1] .&gt; 0.0u&quot;m/Myr&quot;)
    end
end</code></pre><div class="noweb-label">file:<i>test/Components/ProductionSpec.jl</i></div><pre><code class="language- julia hljs">module ProductionSpec
    using Test
    using CarboKitten.Components.Common
    using CarboKitten.Components.Production: Facies, Input, uniform_production
    using CarboKitten.Components.WaterDepth: initial_state

    &lt;&lt;production-spec&gt;&gt;
end</code></pre><script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';
mermaid.initialize({
    startOnLoad: true,
    theme: "neutral"
});
</script></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../waterdepth/">« Water Depth</a><a class="docs-footer-nextpage" href="../sediment_buffer/">Sediment Buffers »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.10.1 on <span class="colophon-date" title="Wednesday 7 May 2025 08:22">Wednesday 7 May 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
